## TCP Q&A

1. 如何确定一个 TCP 连接？

   IP 首部中的源端 IP 地址和目的端IP地址加上 TCP 首部的源端和目的端的端口号来唯一确定一个 TCP 连接。

2. TCP 半关闭

   TCP 提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力。

3. 平静时间

   RFC 973 指出 TCP 在重启后的 MSL 秒内不能建立任何连接。

4. TCP 什么时候发复位报文段

   TCP 首部中的 RST 比特是用于「复位」的。一般来说，无论何时一个报文段发往基准的连接出现错误，TCP 都会发出一个复位报文段。
   
5. TCP 报文段的组成

   TCP 报文段按字节计算，分成块数据流和交互数据流，该比例约为 90% 和 10%。

6. TCP 数据包的大小

   以太网数据包（packet）的大小是固定的，最初是 1518 字节，后来增加到 1522 字节。其中， 1500 字节是负载（payload），22 字节是头信息（head）。
IP 数据包在以太网数据包的负载里面，它也有自己的头信息，最少需要 20 字节，所以 IP 数据包的负载最多为 1480 字节。
   
   TCP 数据包在 IP 数据包的负载里面。它的头信息最少也需要 20 字节，因此 TCP 数据包的最大负载是 1480 - 20 = 1460 字节。由于 IP 和 TCP 协议往往有额外的头信息，所以 TCP 负载实际为 1400 字节左右。
   
7. TCP sequence number 的作用

   因为 TCP 负载实际为 1400 字节左右，如果一次性发送大量数据包，就必须分成多个包。发送的时候，TCP 协议为每个包编号（sequence number，简称 SEQ），以便接收的一方按照顺序还原。万一发生丢包，也可以知道丢失的是哪一个包。
   
8. TCP 协议如何保证数据通信的完整性

   ACK 携带两个信息：期待要收到下一个数据包的编号 和 接收方的接收窗口的剩余容量。
   
   每一个数据包都带有下一个数据包的编号。如果下一个数据包没有收到，那么 ACK 的编号就不会发生变化。
   
   如果发送方发现收到三个连续的重复 ACK，或者超时了还没有收到任何 ACK，就会确认丢包，从而再次发送这个包。通过这种机制，TCP 保证了不会有数据包丢失。
