## UDP 报文的大小

主要影响 UDP 报文大小的三大因素：

* UDP 协议规定报文长度为 16 位，所以 UDP 的报文长度不能超过 2^16 = 65536 字节
* 以太网(Ethernet)数据帧的长度，这是由以太网的物理特性决定，也叫数据链路层的 MTU(最大传输单元)
* socket 的 UDP 发送缓冲区大小

### UDP 最大数据包长度

根据 UDP 协议，从 UDP 数据包的包头可以看出，UDP 的最大包长度是 2^16-1 个字节。

由于 UDP 包头占 8 个字节，而在 IP 层进行封装后的 IP 包头占去 20 字节，所以这个是 UDP 数据包的最大理论长度是 2^16 - 1 - 8 - 20 = 65507 字节。

同时 UDP 发送缓冲区大小（linux下UDP发送缓冲区大小为：cat /proc/sys/net/core/wmem_default）相关，肯定不能超过缓冲区大小。

### UDP 理想数据包长度

每个以太网帧都有最小的大小 64 字节，最大不能超过 1518 字节。

除去链路层的首部和尾部的 18 个字节，链路层的数据区范围是 46-1500 字节，

那么链路层的数据区，即 MTU(最大传输单元)为 1500 字节。

事实上这个 1500 字节就是网络层 IP 数据报的长度限制。

因为 IP 数据报的首部为 20 字节，所以 IP 数据报的数据区长度最大为 1480 字节。而这个 1480 字节就是用来放 TCP 传来的 TCP 报文段或 UDP 传来的 UDP 数据报的。

除去 UDP 包头占 8 个 字节，那么 UDP 数据报的数据区最大长度为 1472 字节。

**结论1：局域网环境下，建议将 UDP 数据控制在 1472 字节以下**

Unix 网络编程第一卷里说：ipv4 协议规定 ip 层的最小重组缓冲区大小为 576 字节，所以将 UDP 数据报的数据区最大长度控制在 548 字节(576-8-20)以内。

**结论2：Internet 编程时，建议将 UDP 数据控制在 548 字节以下**

## 参考

* [UDP 中一个包的大小最大能多大](http://www.52im.net/thread-29-1-1.html)
